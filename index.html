<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For My ❤️</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
    font-family:'Segoe UI',sans-serif;
    color:white;
}

/* INTRO */
.intro{
    position:absolute;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:45px;
    letter-spacing:8px;
    animation:introFade 4s forwards;
}

@keyframes introFade{
    0%{opacity:0; transform:scale(1.2);}
    30%{opacity:1;}
    80%{opacity:1;}
    100%{opacity:0;}
}

/* MESSAGE */
.message{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    text-align:center;
    font-size:26px;
    opacity:0;
    transition:2s;
}

canvas{
    position:fixed;
    top:0;
    left:0;
    pointer-events:none;
}
</style>
</head>

<body>

<div class="intro">FOR MY ❤️</div>

<div class="message" id="msg">
Happy Valentine My ❤️<br><br>
Cảm ơn em vì đã đến bên anh.<br>
Anh mong những ngày sau này<br>
đều có em bên cạnh.
</div>

<canvas id="fireworks"></canvas>

<audio id="music" loop
src="https://cdn.pixabay.com/audio/2022/03/15/audio_6b7b8df8d8.mp3">
</audio>

<script>
document.addEventListener("DOMContentLoaded", function(){

const intro = document.querySelector(".intro");
const msg = document.getElementById("msg");
const music = document.getElementById("music");
const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* START SEQUENCE */
setTimeout(()=>{
    intro.style.display="none";
    msg.style.opacity=1;
    fadeInMusic();

    setTimeout(()=>{
        msg.style.opacity=0;
        startFireworks();
    },5000);

},4000);

/* MUSIC FADE */
function fadeInMusic(){
    music.volume=0;
    music.play().catch(()=>{});
    let v=0;
    let fade=setInterval(()=>{
        if(v<1){
            v+=0.05;
            music.volume=v;
        }else clearInterval(fade);
    },200);
}

/* HEART FORMULA */
function heart(t){
    return {
        x:16*Math.pow(Math.sin(t),3),
        y:-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))
    }
}

let particles=[];

/* NORMAL EXPLOSION */
function explodeNormal(x,y){
    for(let i=0;i<90;i++){
        let angle=Math.random()*Math.PI*2;
        particles.push({
            x,y,
            dx:Math.cos(angle)*5,
            dy:Math.sin(angle)*5,
            alpha:1,
            color:`hsl(${Math.random()*360},100%,60%)`
        });
    }
}

/* HEART EXPLOSION */
function explodeHeart(x,y){
    for(let t=0;t<Math.PI*2;t+=0.1){
        let pos=heart(t);
        particles.push({
            x,y,
            dx:pos.x/3,
            dy:pos.y/3,
            alpha:1,
            color:"pink"
        });
    }
}

/* TEXT MY EXPLOSION */
function explodeText(x,y){

    const off = document.createElement("canvas");
    const offCtx = off.getContext("2d");
    off.width = 300;
    off.height = 150;

    offCtx.fillStyle="white";
    offCtx.font="bold 100px Arial";
    offCtx.textAlign="center";
    offCtx.fillText("MY",150,100);

    const data = offCtx.getImageData(0,0,300,150).data;

    for(let i=0;i<data.length;i+=4){
        if(data[i+3] > 150){
            let px = (i/4)%300;
            let py = Math.floor((i/4)/300);

            particles.push({
                x:x,
                y:y,
                dx:(px-150)/25,
                dy:(py-75)/25,
                alpha:1,
                color:"white"
            });
        }
    }
}

/* ANIMATION LOOP */
function animate(){
    requestAnimationFrame(animate);

    ctx.fillStyle="rgba(0,0,0,0.2)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    for(let i=particles.length-1;i>=0;i--){
        let p=particles[i];

        p.x+=p.dx;
        p.y+=p.dy;
        p.dy+=0.03;
        p.alpha-=0.015;

        ctx.globalAlpha=p.alpha;
        ctx.fillStyle=p.color;
        ctx.beginPath();
        ctx.arc(p.x,p.y,2,0,Math.PI*2);
        ctx.fill();

        if(p.alpha<=0) particles.splice(i,1);
    }

    ctx.globalAlpha=1;
}

function startFireworks(){
    animate();

    setInterval(()=>{
        let r=Math.random();
        let x=Math.random()*canvas.width;
        let y=Math.random()*canvas.height/2;

        if(r<0.4) explodeNormal(x,y);
        else if(r<0.7) explodeHeart(x,y);
        else explodeText(canvas.width/2,canvas.height/3);

    },1200);
}

});
</script>

</body>
</html>
